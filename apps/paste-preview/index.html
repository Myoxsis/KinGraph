<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KinGraph Workbench — Records</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body data-page="records">
    <div class="app-shell">
      <aside class="app-rail" aria-label="Workspace navigation">
        <a class="rail-logo" href="./index.html">
          <span class="rail-logo-mark" aria-hidden="true">KG</span>
          <span class="rail-logo-text">KinGraph</span>
        </a>
        <nav class="rail-nav" aria-label="Primary workspaces">
          <a class="rail-link is-active" href="./index.html" aria-current="page">
            <span class="rail-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M7 3h7l5 5v11a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linejoin="round"
                />
                <path d="M14 3v5h5" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" />
              </svg>
            </span>
            <span class="rail-label">Records</span>
            <span class="rail-badge" id="nav-record-count" aria-hidden="true">0</span>
          </a>
          <a class="rail-link" href="./individuals.html">
            <span class="rail-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm0 2c-4 0-7 2-7 4v1h14v-1c0-2-3-4-7-4Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linejoin="round"
                />
              </svg>
            </span>
            <span class="rail-label">Individuals</span>
            <span class="rail-badge" id="nav-individual-count" aria-hidden="true">0</span>
          </a>
          <a class="rail-link" href="./tree.html">
            <span class="rail-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M12 20v-6m0 0H7a3 3 0 1 1 0-6h10a3 3 0 1 1 0 6h-5Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <circle cx="12" cy="5" r="2.5" stroke="currentColor" stroke-width="1.5" />
              </svg>
            </span>
            <span class="rail-label">Tree</span>
          </a>
          <a class="rail-link" href="./settings.html">
            <span class="rail-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="m12 3 1.2 2.4 2.7.3-1.9 2 0.5 2.7L12 9.6l-2.5 1.3 0.5-2.7-1.9-2 2.7-.3L12 3Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linejoin="round"
                />
                <path
                  d="M5 13.5a7 7 0 1 0 14 0 7 7 0 1 0-14 0Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linejoin="round"
                />
              </svg>
            </span>
            <span class="rail-label">Settings</span>
          </a>
        </nav>
        <div class="rail-footer">
          <button type="button" class="command-button command-button--ghost rail-switcher" aria-label="Switch workspace">
            <span class="rail-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="m6 9-3 3 3 3M18 15l3-3-3-3"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M3 12h18"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                />
              </svg>
            </span>
            <span class="rail-label">Switch workspace</span>
          </button>
        </div>
      </aside>
      <div class="app-surface">
        <header class="command-bar">
          <div class="command-bar-primary">
            <div>
              <p class="command-bar-eyebrow">KinGraph Workbench</p>
              <h1 class="command-title">Records</h1>
            </div>
            <div class="command-metrics">
              <span class="metric-chip" role="status" aria-live="polite">
                <span class="metric-label">Saved records</span>
                <span class="metric-value" id="metric-record-count">0</span>
              </span>
              <span class="metric-chip">
                <span class="metric-label">Confidence avg</span>
                <span class="metric-value" id="metric-confidence-score">—</span>
              </span>
            </div>
          </div>
          <form id="workspace-search-form" class="command-search" role="search" autocomplete="off">
            <label class="visually-hidden" for="workspace-search">Search saved records</label>
            <span class="command-search-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="m20 20-3.5-3.5m1.5-4.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </span>
            <input type="search" id="workspace-search" name="search" placeholder="Search saved records" />
            <button
              type="button"
              id="workspace-search-clear"
              class="command-search-clear"
              aria-label="Clear search"
              hidden
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </form>
          <div class="command-actions">
            <a class="command-button" href="#html-input">Import HTML</a>
            <a class="command-button command-button--primary" href="#save-panel">Save record</a>
          </div>
        </header>
        <main class="workspace" id="main-content">
          <section class="workspace-content" aria-labelledby="workspace-description">
            <p class="workspace-description" id="workspace-description">
              Extract structured records from pasted HTML, link them to individuals, and explore saved data to power your
              genealogical linkage work.
            </p>

            <div class="workspace-grid">
              <section class="workspace-primary" aria-label="Extraction workspace">
                <section class="workspace-section workspace-section--layer workspace-section--stack">
                  <header>
                    <h2>Source extraction</h2>
                  </header>
                  <div>
                    <label for="html-input">Source HTML</label>
                    <textarea id="html-input" placeholder="Paste HTML here..."></textarea>
                    <details class="preprocess-hints">
                      <summary>Suggested clean-up steps</summary>
                      <ul>
                        <li>Remove navigation, advertisements, and unrelated footers.</li>
                        <li>Strip duplicate whitespace and convert smart quotes to straight quotes.</li>
                        <li>Ensure dates use consistent formats (e.g., 12 Jan 1893).</li>
                        <li>Include the full paragraph or table row that contains the subject.</li>
                      </ul>
                    </details>
                  </div>
                  <div class="extraction-toolbar" role="group" aria-label="Extraction helpers">
                    <div class="toolbar-chips" id="sample-chip-row" aria-label="Sample snippets"></div>
                    <label class="toolbar-toggle" for="auto-extract">
                      <input type="checkbox" id="auto-extract" checked />
                      <span>Auto extract</span>
                    </label>
                    <div class="toolbar-status" aria-live="polite">
                      <span id="char-count">0 characters</span>
                      <span id="last-run">Last extracted — never</span>
                    </div>
                    <div class="toolbar-actions">
                      <button id="toggle-sources" type="button" disabled>Highlight sources</button>
                      <button id="reextract" type="button" class="button-secondary" disabled>Run extract</button>
                      <button id="clear-input" type="button" class="button-secondary" disabled>Clear input</button>
                    </div>
                  </div>
                  <iframe id="source-preview" title="Provenance preview" hidden></iframe>
                  <footer class="extraction-helper" id="extraction-helper" aria-live="polite">
                    <span class="helper-label">Last extracted</span>
                    <time id="last-run-footer">Never</time>
                  </footer>
                </section>

                <section class="workspace-section workspace-section--layer workspace-section--stack">
                  <header>
                    <h2>Extracted record</h2>
                    <span id="provenance-count" class="pill" hidden></span>
                  </header>
                  <div>
                    <label for="json-output">Structured record</label>
                    <div id="json-output" class="json-viewer" data-empty="true">Paste HTML to see extracted fields.</div>
                  </div>
                  <div id="error" class="error" hidden></div>
                  <div>
                    <label>Field confidence</label>
                    <div id="confidence" class="confidence-list"></div>
                  </div>
                </section>
              </section>

              <section class="workspace-secondary" aria-label="Record management">
                <section class="workspace-section workspace-section--layer workspace-section--stack" id="save-panel">
                  <header>
                    <h2>Save record</h2>
                  </header>
                  <p class="supporting-text">
                    Create a brand new individual or link the extracted record to someone you have already captured.
                  </p>
                  <form id="save-form">
                    <fieldset>
                      <div class="choice">
                        <label>
                          <input type="radio" name="save-mode" id="save-mode-new" value="new" checked />
                          Create a new individual
                        </label>
                        <div class="control">
                          <label for="new-individual-name">Individual name</label>
                          <input type="text" id="new-individual-name" name="new-individual-name" />
                        </div>
                      </div>
                      <div class="choice">
                        <label>
                          <input type="radio" name="save-mode" id="save-mode-existing" value="existing" />
                          Link to an existing individual
                        </label>
                        <div class="control">
                          <label for="existing-individual-select">Choose individual</label>
                          <select id="existing-individual-select" name="existing-individual"></select>
                        </div>
                      </div>
                    </fieldset>
                    <div id="match-suggestions" class="match-suggestions" hidden>
                      <p class="supporting-text">
                        This record resembles existing individuals. Select a match to fill in the link automatically.
                      </p>
                      <ul id="match-suggestions-list" class="match-suggestions-list"></ul>
                    </div>
                    <div class="card-actions">
                      <button type="submit" id="save-button">Save record</button>
                      <span id="save-feedback" class="supporting-text" aria-live="polite"></span>
                    </div>
                  </form>
                </section>

                <section class="workspace-section workspace-section--layer">
                  <header>
                    <h2>Saved records</h2>
                    <button type="button" id="clear-records" class="button-secondary">Clear all</button>
                  </header>
                  <div id="saved-records" class="saved-records">
                    <form id="records-filters" class="records-filters" autocomplete="off">
                      <div class="filter-field">
                        <label for="filter-individual">Individual</label>
                        <select id="filter-individual" name="individual"></select>
                      </div>
                      <div class="filter-field filter-date">
                        <label for="filter-start-date">From</label>
                        <input type="date" id="filter-start-date" name="start" />
                      </div>
                      <div class="filter-field filter-date">
                        <label for="filter-end-date">To</label>
                        <input type="date" id="filter-end-date" name="end" />
                      </div>
                      <div class="filter-field filter-confidence">
                        <label for="filter-confidence">Confidence</label>
                        <div class="slider-control">
                          <input
                            type="range"
                            id="filter-confidence"
                            name="confidence"
                            min="0"
                            max="100"
                            step="5"
                            value="0"
                          />
                          <output id="filter-confidence-value" for="filter-confidence">0%</output>
                        </div>
                      </div>
                      <div class="filter-actions">
                        <button type="reset" class="button-secondary">Reset filters</button>
                      </div>
                    </form>
                    <div class="records-timeline" id="records-timeline"></div>
                  </div>
                </section>
              </section>
            </div>
          </section>
        </main>
      </div>
    </div>

    <script type="module" src="./main.ts"></script>
  </body>
</html>
